-- –£–¥–∞–ª—è–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —Ç–∞–±–ª–∏—Ü—ã, —á—Ç–æ–±—ã –∏–∑–±–µ–∂–∞—Ç—å –æ—à–∏–±–æ–∫ –ø—Ä–∏ –ø–æ–≤—Ç–æ—Ä–Ω–æ–π –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏
DROP TABLE IF EXISTS replies CASCADE;
DROP TABLE IF EXISTS topics CASCADE;
DROP TABLE IF EXISTS users CASCADE;

-- ===================================
-- üîê –¢–∞–±–ª–∏—Ü–∞ –¥–ª—è —Å–µ—Ä–≤–∏—Å–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ (auth-service)
-- ===================================
CREATE TABLE users (
    id SERIAL PRIMARY KEY,               -- –£–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    username VARCHAR(100) UNIQUE NOT NULL, -- –£–Ω–∏–∫–∞–ª—å–Ω–æ–µ –∏–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    password VARCHAR(255) NOT NULL,      -- –ü–∞—Ä–æ–ª—å (–≤–æ–∑–º–æ–∂–Ω–æ, –±–µ–∑ —Ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è)
    role VARCHAR(50) DEFAULT 'user',     -- –†–æ–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–Ω–∞–ø—Ä–∏–º–µ—Ä, 'user' –∏–ª–∏ 'doctor')
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP -- –î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞–ø–∏—Å–∏
);

-- –î–æ–±–∞–≤–∏–º –Ω–µ—Å–∫–æ–ª—å–∫–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –¥–ª—è —Ç–µ—Å—Ç–∞
INSERT INTO users (username, password, role) 
VALUES 
    ('admin', 'admin', 'doctor'), 
    ('user', 'user', 'user');

-- ===================================
-- üìú –¢–∞–±–ª–∏—Ü–∞ –¥–ª—è —Ç–µ–º —Ñ–æ—Ä—É–º–∞ (backend)
-- ===================================
CREATE TABLE topics (
    id SERIAL PRIMARY KEY,               -- –£–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä —Ç–µ–º—ã
    title VARCHAR(255) NOT NULL,         -- –ù–∞–∑–≤–∞–Ω–∏–µ —Ç–µ–º—ã
    content TEXT NOT NULL,               -- –°–æ–¥–µ—Ä–∂–∏–º–æ–µ —Ç–µ–º—ã
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP -- –î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è —Ç–µ–º—ã
);

-- –î–æ–±–∞–≤–∏–º –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ç–µ—Å—Ç–æ–≤—ã—Ö —Ç–µ–º
INSERT INTO topics (title, content) 
VALUES 
    ('–ö–∞–∫ –ª–µ—á–∏—Ç—å –∫–∞—à–µ–ª—å?', '–ö–∞–∫–∏–µ –º–µ—Ç–æ–¥—ã –ª—É—á—à–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥–ª—è –ª–µ—á–µ–Ω–∏—è —Å—É—Ö–æ–≥–æ –∫–∞—à–ª—è?'), 
    ('–ß—Ç–æ –¥–µ–ª–∞—Ç—å –ø—Ä–∏ —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–µ 38?', '–ö–∞–∫–∏–µ –ª–µ–∫–∞—Ä—Å—Ç–≤–∞ –ª—É—á—à–µ –ø—Ä–∏–Ω–∏–º–∞—Ç—å –ø—Ä–∏ –≤—ã—Å–æ–∫–æ–π —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–µ?');

-- ===================================
-- üí¨ –¢–∞–±–ª–∏—Ü–∞ –¥–ª—è –æ—Ç–≤–µ—Ç–æ–≤ –Ω–∞ —Ç–µ–º—ã (backend)
-- ===================================
CREATE TABLE replies (
    id SERIAL PRIMARY KEY,               -- –£–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –æ—Ç–≤–µ—Ç–∞
    content TEXT NOT NULL,               -- –°–æ–¥–µ—Ä–∂–∏–º–æ–µ –æ—Ç–≤–µ—Ç–∞
    author_id INTEGER NOT NULL,          -- ID –∞–≤—Ç–æ—Ä–∞ –æ—Ç–≤–µ—Ç–∞ (—Å—Å—ã–ª–∫–∞ –Ω–∞ —Ç–∞–±–ª–∏—Ü—É users)
    topic_id INTEGER NOT NULL,           -- ID —Ç–µ–º—ã, –∫ –∫–æ—Ç–æ—Ä–æ–π –æ—Ç–Ω–æ—Å–∏—Ç—Å—è –æ—Ç–≤–µ—Ç (—Å—Å—ã–ª–∫–∞ –Ω–∞ —Ç–∞–±–ª–∏—Ü—É topics)
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP, -- –î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è –æ—Ç–≤–µ—Ç–∞
    FOREIGN KEY (author_id) REFERENCES users (id) ON DELETE CASCADE, -- –í–Ω–µ—à–Ω–∏–π –∫–ª—é—á –¥–ª—è —Å–≤—è–∑–∏ —Å users
    FOREIGN KEY (topic_id) REFERENCES topics (id) ON DELETE CASCADE -- –í–Ω–µ—à–Ω–∏–π –∫–ª—é—á –¥–ª—è —Å–≤—è–∑–∏ —Å topics
);

-- –î–æ–±–∞–≤–∏–º –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ç–µ—Å—Ç–æ–≤—ã—Ö –æ—Ç–≤–µ—Ç–æ–≤
INSERT INTO replies (content, author_id, topic_id) 
VALUES 
    ('–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–∏—Ç—å –±–æ–ª—å—à–µ –≤–æ–¥—ã –∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å–∏—Ä–æ–ø –æ—Ç –∫–∞—à–ª—è.', 2, 1), 
    ('–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –ø—Ä–∏–Ω–∏–º–∞—Ç—å –ø–∞—Ä–∞—Ü–µ—Ç–∞–º–æ–ª –∏ –Ω–∞–±–ª—é–¥–∞—Ç—å –∑–∞ —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–æ–π.', 1, 2);

-- ===================================
-- ‚úÖ –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ –∏ –≤—ã–≤–æ–¥ —Å—Ç–∞—Ç—É—Å–∞
-- ===================================
-- –í—ã–≤–æ–¥–∏–º —Å–æ–æ–±—â–µ–Ω–∏–µ –¥–ª—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è —É—Å–ø–µ—à–Ω–æ–≥–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è —Å–∫—Ä–∏–ø—Ç–∞
DO $$ 
BEGIN 
    RAISE NOTICE '–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–∞ —É—Å–ø–µ—à–Ω–æ'; 
END $$;
